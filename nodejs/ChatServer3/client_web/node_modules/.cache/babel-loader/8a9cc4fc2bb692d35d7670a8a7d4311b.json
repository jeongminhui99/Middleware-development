{"ast":null,"code":"import _slicedToArray from\"/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{Component,useEffect,useState}from'react';import\"./App.css\";import socket from\"./socket\";import SelectUsername from\"./components/SelectUsername\";import Chat from\"./components/Chat\";import Test from\"./components/test\";import{jsx as _jsx}from\"react/jsx-runtime\";export default function App(){//localStorage.clear();\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),username=_useState2[0],setUsername=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),usernameAlreadySelected=_useState4[0],setUsernameAlreadySelected=_useState4[1];//const [sessionID, setSessionID] = useState(localStorage.getItem(\"sessionID\"));\nvar sessionID=localStorage.getItem(\"sessionID\");var getData=function getData(username){//onUsernameSelection\nsetUsername(username);console.log(username);setUsernameAlreadySelected(true);socket.auth={username:username};socket.connect();};if(sessionID){// 새로고침 시 바로 chat으로 넘어감\nconsole.log(\"session있음\");if(usernameAlreadySelected===false){setUsernameAlreadySelected(true);};//setUsernameAlreadySelected(true);\nsocket.auth={sessionID:sessionID};socket.connect();};// useEffect(() => {\n//     socket.on(\"session\", ({ sessionID, userID }) => {\n//         console.log(\"session\");\n//         // attach the session ID to the next reconnection attempts\n//         socket.auth = { sessionID };\n//         // store it in the localStorage\n//         localStorage.setItem(\"sessionID\", sessionID);\n//         setSessionID(sessionID);\n//         // save the ID of the user\n//         socket.userID = userID;\n//     });\n// }, []);\nsocket.on(\"session\",function(_ref){var sessionID=_ref.sessionID,userID=_ref.userID;console.log(\"session\");// attach the session ID to the next reconnection attempts\nsocket.auth={sessionID:sessionID};// store it in the localStorage\nlocalStorage.setItem(\"sessionID\",sessionID);// save the ID of the user\nsocket.userID=userID;});socket.on(\"connect_error\",function(err){if(err.message===\"invalid username\"){setUsernameAlreadySelected(false);}});useEffect(function(){return function(){console.log(\"UNMOUNT\");socket.off(\"connect_error\");};},[]);// useEffect(()=>{\n//     socket.on(\"connect_error\", (err) => {\n//         if (err.message === \"invalid username\") {\n//         this.usernameAlreadySelected = false;\n//         }\n//     });\n// })\nreturn/*#__PURE__*/_jsx(\"div\",{id:\"app\",children:!usernameAlreadySelected?/*#__PURE__*/_jsx(SelectUsername,{username:username,getData:getData}):/*#__PURE__*/_jsx(Test,{})});}","map":{"version":3,"sources":["/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/src/App.js"],"names":["React","Component","useEffect","useState","socket","SelectUsername","Chat","Test","App","username","setUsername","usernameAlreadySelected","setUsernameAlreadySelected","sessionID","localStorage","getItem","getData","console","log","auth","connect","on","userID","setItem","err","message","off"],"mappings":"iJAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,SAA3B,CAAsCC,QAAtC,KAAsD,OAAtD,CACA,MAAO,WAAP,CACA,MAAOC,CAAAA,MAAP,KAAmB,UAAnB,CACA,MAAOC,CAAAA,cAAP,KAA2B,6BAA3B,CACA,MAAOC,CAAAA,IAAP,KAAiB,mBAAjB,CACA,MAAOC,CAAAA,IAAP,KAAiB,mBAAjB,C,2CAEA,cAAe,SAASC,CAAAA,GAAT,EAAe,CAC1B;AACA,cAAgCL,QAAQ,CAAC,EAAD,CAAxC,wCAAOM,QAAP,eAAiBC,WAAjB,eACA,eAA8DP,QAAQ,CAAC,KAAD,CAAtE,yCAAOQ,uBAAP,eAAgCC,0BAAhC,eACA;AACA,GAAMC,CAAAA,SAAS,CAAGC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAlB,CAGA,GAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACP,QAAD,CAAc,CAAE;AAC5BC,WAAW,CAACD,QAAD,CAAX,CACAQ,OAAO,CAACC,GAAR,CAAYT,QAAZ,EACAG,0BAA0B,CAAC,IAAD,CAA1B,CACAR,MAAM,CAACe,IAAP,CAAc,CAAEV,QAAQ,CAARA,QAAF,CAAd,CACAL,MAAM,CAACgB,OAAP,GACH,CAND,CASA,GAAIP,SAAJ,CAAe,CAAE;AACbI,OAAO,CAACC,GAAR,CAAY,WAAZ,EACA,GAAIP,uBAAuB,GAAK,KAAhC,CAAsC,CAClCC,0BAA0B,CAAC,IAAD,CAA1B,CACH,CACT,CAAQ;AACAR,MAAM,CAACe,IAAP,CAAc,CAAEN,SAAS,CAATA,SAAF,CAAd,CACAT,MAAM,CAACgB,OAAP,GACH,EAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAhB,MAAM,CAACiB,EAAP,CAAU,SAAV,CAAqB,cAA2B,IAAxBR,CAAAA,SAAwB,MAAxBA,SAAwB,CAAbS,MAAa,MAAbA,MAAa,CAC5CL,OAAO,CAACC,GAAR,CAAY,SAAZ,EACA;AACAd,MAAM,CAACe,IAAP,CAAc,CAAEN,SAAS,CAATA,SAAF,CAAd,CACA;AACAC,YAAY,CAACS,OAAb,CAAqB,WAArB,CAAkCV,SAAlC,EACA;AACAT,MAAM,CAACkB,MAAP,CAAgBA,MAAhB,CACH,CARD,EAUAlB,MAAM,CAACiB,EAAP,CAAU,eAAV,CAA2B,SAACG,GAAD,CAAS,CAChC,GAAIA,GAAG,CAACC,OAAJ,GAAgB,kBAApB,CAAwC,CACpCb,0BAA0B,CAAC,KAAD,CAA1B,CACH,CACJ,CAJD,EAMAV,SAAS,CAAC,UAAM,CACZ,MAAO,WAAM,CACTe,OAAO,CAACC,GAAR,CAAY,SAAZ,EACAd,MAAM,CAACsB,GAAP,CAAW,eAAX,EACH,CAHD,CAIH,CALQ,CAKN,EALM,CAAT,CAOA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA,mBACI,YAAK,EAAE,CAAC,KAAR,UACK,CAACf,uBAAD,cAA0B,KAAC,cAAD,EAAgB,QAAQ,CAAEF,QAA1B,CAAoC,OAAO,CAAEO,OAA7C,EAA1B,cAAoF,KAAC,IAAD,IADzF,EADJ,CAMH","sourcesContent":["import React, { Component, useEffect, useState } from 'react';\nimport \"./App.css\";\nimport socket from \"./socket\";\nimport SelectUsername from \"./components/SelectUsername\";\nimport Chat from \"./components/Chat\";\nimport Test from \"./components/test\";\n\nexport default function App() {\n    //localStorage.clear();\n    const [username, setUsername] = useState('');\n    const [usernameAlreadySelected, setUsernameAlreadySelected] = useState(false);\n    //const [sessionID, setSessionID] = useState(localStorage.getItem(\"sessionID\"));\n    const sessionID = localStorage.getItem(\"sessionID\");\n\n\n    const getData = (username) => { //onUsernameSelection\n        setUsername(username);\n        console.log(username);\n        setUsernameAlreadySelected(true);\n        socket.auth = { username };\n        socket.connect();\n    };\n\n\n    if (sessionID) { // 새로고침 시 바로 chat으로 넘어감\n        console.log(\"session있음\");\n        if (usernameAlreadySelected === false){\n            setUsernameAlreadySelected(true);\n        }\n;       //setUsernameAlreadySelected(true);\n        socket.auth = { sessionID };\n        socket.connect();\n    };\n\n    // useEffect(() => {\n    //     socket.on(\"session\", ({ sessionID, userID }) => {\n    //         console.log(\"session\");\n    //         // attach the session ID to the next reconnection attempts\n    //         socket.auth = { sessionID };\n    //         // store it in the localStorage\n    //         localStorage.setItem(\"sessionID\", sessionID);\n    //         setSessionID(sessionID);\n    //         // save the ID of the user\n    //         socket.userID = userID;\n    //     });\n    // }, []);\n    \n    socket.on(\"session\", ({ sessionID, userID }) => {\n        console.log(\"session\");\n        // attach the session ID to the next reconnection attempts\n        socket.auth = { sessionID };\n        // store it in the localStorage\n        localStorage.setItem(\"sessionID\", sessionID);\n        // save the ID of the user\n        socket.userID = userID;\n    });\n\n    socket.on(\"connect_error\", (err) => {\n        if (err.message === \"invalid username\") {\n            setUsernameAlreadySelected(false);\n        }\n    });\n\n    useEffect(() => {\n        return () => {\n            console.log(\"UNMOUNT\")\n            socket.off(\"connect_error\");\n        }\n    }, []);\n\n    // useEffect(()=>{\n\n    //     socket.on(\"connect_error\", (err) => {\n    //         if (err.message === \"invalid username\") {\n    //         this.usernameAlreadySelected = false;\n    //         }\n    //     });\n    // })\n\n    return(\n        <div id=\"app\">\n            {!usernameAlreadySelected? <SelectUsername username={username} getData={getData}/> : <Test/> }\n        </div> \n\n    );\n}\n"]},"metadata":{},"sourceType":"module"}