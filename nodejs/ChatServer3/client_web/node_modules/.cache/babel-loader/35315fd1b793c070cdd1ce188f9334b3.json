{"ast":null,"code":"import _slicedToArray from\"/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{Component,useEffect,useState}from'react';import socket from\"../socket\";import User from\"./User\";import MessagePanel from\"./MessagePanel\";import\"./Chat.scoped.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(){var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selectedUser=_useState2[0],setSelectedUser=_useState2[1];//const [selectedm, setSelectedm] = useState({id:\"fff\", ff:[{d:\"ddd\"}]});\nvar _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),users=_useState4[0],setUsers=_useState4[1];socket.on(\"connect\",function(){console.log(\"clientconnect\");users.forEach(function(user){if(user.self){user.connected=true;}});});socket.on(\"disconnect\",function(){users.forEach(function(user){if(user.self){user.connected=false;}});});socket.on(\"users\",function(userss){userss.forEach(function(user){console.log(\"user : \",user);for(var i=0;i<userss.length;i++){var existingUser=userss[i];if(existingUser.userID===user.userID){existingUser.connected=user.connected;return;}}user.self=user.userID===socket.userID;//user.self = user.userID === socket.id; \ninitReactiveProperties(user);userss.push(user);});// put the current user first, and sort by username\nvar userstmp=[];userstmp=userss.sort(function(a,b){if(a.self)return-1;if(b.self)return 1;if(a.username<b.username)return-1;return a.username>b.username?1:0;});setUsers(userstmp);console.log(\"userstmp : \",userstmp);});socket.on(\"user connected\",function(user){for(var i=0;i<users.length;i++){var existingUser=users[i];if(existingUser.userID===user.userID){existingUser.connected=true;return;}}initReactiveProperties(user);setUsers(users.concat(user));console.log(\"user connected : \",users);//users.push(user);\n});socket.on(\"user disconnected\",function(id){for(var i=0;i<users.length;i++){var user=users[i];if(user.userID===id){user.connected=false;setUsers(users);break;}}});useEffect(function(){socket.on(\"private message\",function(_ref){var content=_ref.content,from=_ref.from,to=_ref.to;console.log(\"content\",content,selectedUser);for(var i=0;i<users.length;i++){var user=users[i];var fromSelf=socket.userID===from;if(user.userID===(fromSelf?to:from)){console.log(\"content22\",content,selectedUser);user.messages.push({content:content,fromSelf:fromSelf});if(user!==selectedUser){user.hasNewMessages=true;}break;}}setSelectedUser(null);setSelectedUser(selectedUser);});return function(){console.log(\"UNMOUNT\");socket.off(\"private message\");};});useEffect(function(){return function(){console.log(\"UNMOUNT\");socket.off(\"connect\");socket.off(\"disconnect\");socket.off(\"users\");socket.off(\"user connected\");socket.off(\"user disconnected\");};},[]);var initReactiveProperties=function initReactiveProperties(user){//user.connected = true;\nuser.messages=[];user.hasNewMessages=false;};var getSelectUser=function getSelectUser(selectuser){setSelectedUser(selectuser);selectuser.hasNewMessages=false;console.log(\"selectuser : \",selectuser);};var onMessage=function onMessage(content){console.log(\"onMessage : \",content,users,selectedUser);if(selectedUser){//console.log(\"selectedUser : \", selectedUser);\nsocket.emit(\"private message\",{content:content,to:selectedUser.userID});selectedUser.messages.push({content:content,fromSelf:true});}};// const onSelectUser = (user) => {\n//     setSelectedUser(user);\n//     user.hasNewMessages = false;\n// }\nreturn/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"left-panel\",children:users.map(function(user){return/*#__PURE__*/_jsx(User,{user:user,selected:selectedUser===user,getSelectUser:getSelectUser},user.userID);})}),/*#__PURE__*/_jsx(\"div\",{className:\"right-panel\",children:selectedUser?/*#__PURE__*/_jsx(MessagePanel,{user:selectedUser,onMessage:onMessage,className:\"right-panel\"}):null})]});};export default Chat;","map":{"version":3,"sources":["/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/src/components/Chat.js"],"names":["React","Component","useEffect","useState","socket","User","MessagePanel","Chat","selectedUser","setSelectedUser","users","setUsers","on","console","log","forEach","user","self","connected","userss","i","length","existingUser","userID","initReactiveProperties","push","userstmp","sort","a","b","username","concat","id","content","from","to","fromSelf","messages","hasNewMessages","off","getSelectUser","selectuser","onMessage","emit","map"],"mappings":"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","sourcesContent":["import React, { Component, useEffect, useState } from 'react';\nimport socket from \"../socket\";\nimport User from \"./User\";\nimport MessagePanel from \"./MessagePanel\";\nimport \"./Chat.scoped.css\";\n\nconst Chat = () => {\n    const [selectedUser, setSelectedUser] = useState(null);\n    //const [selectedm, setSelectedm] = useState({id:\"fff\", ff:[{d:\"ddd\"}]});\n    const [users, setUsers] = useState([]);\n\n\n    socket.on(\"connect\", () => {\n        console.log(\"clientconnect\");\n        users.forEach((user) => {\n            if (user.self) {\n                user.connected = true;\n            }\n        });\n    });\n      \n    socket.on(\"disconnect\", () => {\n        users.forEach((user) => {\n            if (user.self) {\n                user.connected = false;\n            }\n        });\n    });\n\n    socket.on(\"users\", (userss) => {\n        userss.forEach((user) => {\n            console.log(\"user : \", user);\n            for (let i = 0; i < userss.length; i++) {\n                const existingUser = userss[i];\n                if (existingUser.userID === user.userID) {\n                    existingUser.connected = user.connected;\n                    return;\n                }\n            }\n            user.self = user.userID === socket.userID;\n            //user.self = user.userID === socket.id; \n            initReactiveProperties(user);\n            userss.push(user);\n        });\n        // put the current user first, and sort by username\n        var userstmp = []\n        userstmp = userss.sort((a, b) => {\n            if (a.self) return -1;\n            if (b.self) return 1;\n            if (a.username < b.username) return -1;\n            return a.username > b.username ? 1 : 0;\n        });\n        setUsers(userstmp);\n        console.log(\"userstmp : \", userstmp);\n        \n    });\n\n    socket.on(\"user connected\", (user) => {\n        for (let i = 0; i < users.length; i++) {\n            const existingUser = users[i];\n            if (existingUser.userID === user.userID){\n                existingUser.connected = true;\n                return;\n            }\n        }\n        initReactiveProperties(user);\n        setUsers(users.concat(user));\n        console.log(\"user connected : \", users);\n        //users.push(user);\n    });\n  \n    socket.on(\"user disconnected\", (id) => {\n        for (let i = 0; i < users.length; i++) {\n            const user = users[i];\n            if (user.userID === id) {\n                user.connected = false;\n                setUsers(users);\n                break;\n            }\n        }\n    });\n\n    useEffect(()=> {\n        socket.on(\"private message\", ({ content, from, to }) => {\n            console.log(\"content\", content, selectedUser);       \n            for (let i = 0; i < users.length; i++) {\n                const user = users[i];\n                const fromSelf = socket.userID === from;\n                if (user.userID === (fromSelf ? to : from)) {\n                    console.log(\"content22\", content, selectedUser);        \n                    user.messages.push({\n                        content,\n                        fromSelf,\n                    });  \n                    if (user !== selectedUser) {\n                        user.hasNewMessages = true;\n                    }\n                    break;\n                }\n            }\n            setSelectedUser(null);\n            setSelectedUser(selectedUser);\n        });\n        return () => {\n            console.log(\"UNMOUNT\")\n            socket.off(\"private message\");\n        }\n    });\n\n\n    useEffect(() => {\n        return () => {\n            console.log(\"UNMOUNT\")\n            socket.off(\"connect\");\n            socket.off(\"disconnect\");\n            socket.off(\"users\");\n            socket.off(\"user connected\");\n            socket.off(\"user disconnected\");\n        }\n    }, []);\n  \n    const initReactiveProperties = (user) => {\n        //user.connected = true;\n        user.messages = [];\n        user.hasNewMessages = false;\n    };\n\n    const getSelectUser = (selectuser) => {\n        setSelectedUser(selectuser);\n        selectuser.hasNewMessages = false;\n        console.log(\"selectuser : \", selectuser);\n    }\n\n    const onMessage = (content) => {\n        console.log(\"onMessage : \", content, users, selectedUser);\n        if(selectedUser){\n            //console.log(\"selectedUser : \", selectedUser);\n            socket.emit(\"private message\", {\n                content,\n                to: selectedUser.userID,\n            });\n\n            selectedUser.messages.push({\n                content,\n                fromSelf: true,\n            });\n        }\n    }\n    // const onSelectUser = (user) => {\n    //     setSelectedUser(user);\n    //     user.hasNewMessages = false;\n    // }\n\n    return(\n        <div>\n            <div className=\"left-panel\">\n                {\n                    users.map(user => (\n                        <User user={user} key={user.userID} selected={selectedUser === user} getSelectUser={getSelectUser}/>\n                    ))\n                }\n            </div>\n            <div className=\"right-panel\">\n            \n                {\n                    selectedUser?\n                    <MessagePanel user = {selectedUser} onMessage = {onMessage} className=\"right-panel\"/> : null\n                }\n\n            </div>\n        </div>\n    );\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}