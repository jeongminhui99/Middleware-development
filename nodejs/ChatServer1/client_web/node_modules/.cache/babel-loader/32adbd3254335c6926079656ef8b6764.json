{"ast":null,"code":"import _slicedToArray from\"/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _objectDestructuringEmpty from\"/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/node_modules/@babel/runtime/helpers/esm/objectDestructuringEmpty.js\";import React,{Component,useState}from'react';import socket from\"../socket\";import User from\"./User\";import MessagePanel from\"./MessagePanel\";import\"./Chat.css\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Chat=function Chat(_ref){_objectDestructuringEmpty(_ref);var _useState=useState(null),_useState2=_slicedToArray(_useState,2),selectedUser=_useState2[0],setSelectedUser=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),users=_useState4[0],setUsers=_useState4[1];socket.on(\"connect\",function(){console.log(\"clientconnect\");// users.forEach((user) => {\n//     if (user.self) {\n//         user.connected = true;\n//     }\n// });\n});socket.on(\"disconnect\",function(){// users.forEach((user) => {\n//     if (user.self) {\n//         user.connected = false;\n//     }\n// });\n});var initReactiveProperties=function initReactiveProperties(user){user.connected=true;user.messages=[];user.hasNewMessages=false;};socket.on(\"users\",function(userss){// userss.forEach((user) => {\n//     user.self = user.userID === socket.id; \n//     initReactiveProperties(user);\n// });\n// // put the current user first, and sort by username\n// users = userss.sort((a, b) => {\n//     if (a.self) return -1;\n//     if (b.self) return 1;\n//     if (a.username < b.username) return -1;\n//     return a.username > b.username ? 1 : 0;\n// });\n});socket.on(\"user connected\",function(user){// initReactiveProperties(user);\n// users.push(user);\n});socket.on(\"user disconnected\",function(id){// for (let i = 0; i < users.length; i++) {\n//     const user = this.users[i];\n//     if (user.userID === id) {\n//         user.connected = false;\n//         break;\n//     }\n// }\n});socket.on(\"private message\",function(_ref2){// for (let i = 0; i < users.length; i++) {\n//     const user = users[i];\n//     if (user.userID === from) {\n//         user.messages.push({\n//             content,\n//             fromSelf: false,\n//         });\n//         if (user !== selectedUser) {\n//             user.hasNewMessages = true;\n//         }\n//         break;\n//     }\n// }\nvar content=_ref2.content,from=_ref2.from;});React.useEffect(function(){return function(){console.log(\"UNMOUNT\");socket.off(\"connect\");socket.off(\"disconnect\");socket.off(\"users\");socket.off(\"user connected\");socket.off(\"user disconnected\");socket.off(\"private message\");};},[]);var onMessage=function onMessage(content){if(selectedUser){socket.emit(\"private message\",{content:content,to:selectedUser.userID});selectedUser.messages.push({content:content,fromSelf:true});}};var onSelectUser=function onSelectUser(user){setSelectedUser(user);user.hasNewMessages=false;};return/*#__PURE__*/_jsxs(\"div\",{className:\"left-panel\",children:[/*#__PURE__*/_jsx(User,{user:users,selected:selectedUser}),/*#__PURE__*/_jsx(MessagePanel,{})]});};export default Chat;","map":{"version":3,"sources":["/Users/minhuijeong/Documents/Nodejs/OXGameServer/client_web/src/components/Chat.js"],"names":["React","Component","useState","socket","User","MessagePanel","Chat","selectedUser","setSelectedUser","users","setUsers","on","console","log","initReactiveProperties","user","connected","messages","hasNewMessages","userss","id","content","from","useEffect","off","onMessage","emit","to","userID","push","fromSelf","onSelectUser"],"mappings":"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","sourcesContent":["import React, { Component, useState } from 'react';\nimport socket from \"../socket\";\nimport User from \"./User\";\nimport MessagePanel from \"./MessagePanel\";\nimport \"./Chat.css\";\n\nconst Chat = ({}) => {\n    const [selectedUser, setSelectedUser] = useState(null);\n    const [users, setUsers] = useState([]);\n    socket.on(\"connect\", () => {\n        console.log(\"clientconnect\");\n        // users.forEach((user) => {\n        //     if (user.self) {\n        //         user.connected = true;\n        //     }\n        // });\n    });\n  \n    socket.on(\"disconnect\", () => {\n        // users.forEach((user) => {\n        //     if (user.self) {\n        //         user.connected = false;\n        //     }\n        // });\n    });\n  \n    const initReactiveProperties = (user) => {\n        user.connected = true;\n        user.messages = [];\n        user.hasNewMessages = false;\n    };\n\n    socket.on(\"users\", (userss) => {\n        // userss.forEach((user) => {\n        //     user.self = user.userID === socket.id; \n        //     initReactiveProperties(user);\n        // });\n        // // put the current user first, and sort by username\n        // users = userss.sort((a, b) => {\n        //     if (a.self) return -1;\n        //     if (b.self) return 1;\n        //     if (a.username < b.username) return -1;\n        //     return a.username > b.username ? 1 : 0;\n        // });\n    });\n  \n    socket.on(\"user connected\", (user) => {\n        // initReactiveProperties(user);\n        // users.push(user);\n    });\n  \n    socket.on(\"user disconnected\", (id) => {\n        // for (let i = 0; i < users.length; i++) {\n        //     const user = this.users[i];\n        //     if (user.userID === id) {\n        //         user.connected = false;\n        //         break;\n        //     }\n        // }\n    });\n\n    socket.on(\"private message\", ({ content, from }) => {\n        // for (let i = 0; i < users.length; i++) {\n        //     const user = users[i];\n        //     if (user.userID === from) {\n        //         user.messages.push({\n        //             content,\n        //             fromSelf: false,\n        //         });\n        //         if (user !== selectedUser) {\n        //             user.hasNewMessages = true;\n        //         }\n        //         break;\n        //     }\n        // }\n    });\n\n    React.useEffect(() => {\n        return () => {\n            console.log(\"UNMOUNT\")\n            socket.off(\"connect\");\n            socket.off(\"disconnect\");\n            socket.off(\"users\");\n            socket.off(\"user connected\");\n            socket.off(\"user disconnected\");\n            socket.off(\"private message\");\n        }\n    }, []);\n\n    const onMessage = (content) => {\n        if(selectedUser){\n            socket.emit(\"private message\", {\n                content,\n                to: selectedUser.userID,\n            });\n            selectedUser.messages.push({\n                content,\n                fromSelf: true,\n            });\n        }\n    }\n    const onSelectUser = (user) => {\n        setSelectedUser(user);\n        user.hasNewMessages = false;\n    }\n\n\n\n    return(\n        <div className=\"left-panel\">\n\n            <User user={users} selected={selectedUser}/>\n            <MessagePanel/>\n        </div>\n    );\n}\n\nexport default Chat;"]},"metadata":{},"sourceType":"module"}